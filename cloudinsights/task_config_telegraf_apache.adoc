---
sidebar: sidebar 
permalink: task_config_telegraf_apache.html 
keywords: telegraf, installation, install, apache 
summary: Apache 数据收集器配置 
---
= Apache Data Collector
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
通过此数据收集器，可以从环境中的 Apache 服务器收集数据。

.前提条件
* 您必须已设置 Apache HTTP 服务器并正确运行
* 您必须对代理主机 /VM 具有 sudo 或管理员权限
* 通常， Apache _mod_status_ 模块会配置为在 Apache 服务器的 /server-status ？ auto 位置公开页面。要收集所有可用字段，必须启用 _ExtendedStatus_ 选项。有关如何配置服务器的信息，请参见 Apache 模块文档： https://httpd.apache.org/docs/2.4/mod/mod_status.html#enable[]




== 安装

. 从*Observability > Collectors*中，单击*+Data Collector*。选择Apache。
+
选择安装了 Telegraf 代理的操作系统或平台。

. 如果您尚未安装要收集的代理，或者您希望为其他操作系统或平台安装代理，请单击 _Show Instructions_展开 link:task_config_telegraf_agent.html["代理安装"] 说明。
. 选择要用于此数据收集器的代理访问密钥。您可以通过单击 * + 代理访问密钥 * 按钮来添加新的代理访问密钥。最佳实践：仅当您要按操作系统 / 平台对数据收集器进行分组时，才使用其他代理访问密钥。
. 按照配置步骤配置数据收集器。这些说明因用于收集数据的操作系统或平台的类型而异。


image:ApacheDCConfigLinux.png["Apache 配置"]



== 设置

Telegraf 用于 Apache HTTP 服务器的插件依赖于 "mod_status" 模块的启用。启用此选项后， Apache 的 HTTP 服务器将显示一个 HTML 端点，您可以在浏览器上查看此端点，也可以对其进行擦除，以便提取所有 Apache 的 HTTP 服务器配置的状态。



=== 兼容性：

此配置是根据 Apache 的 HTTP 服务器版本 2.4.38 开发的。



=== 正在启用 mod_status ：

启用和公开 "mod_status" 模块涉及两个步骤：

* 正在启用模块
* 从模块中公开统计信息




=== 启用模块：

模块的加载由 "/usr/local/apache/conf/httpd.conf " 下的配置文件控制。编辑此配置文件并取消注释以下行：

 LoadModule status_module modules/mod_status.so
 Include conf/extra/httpd-info.conf


=== 从模块公开统计信息：

"od_status" 的公开由 "/usr/local/apache2/conf/ext/httpd-info.conf " 下的配置文件控制。请确保此配置文件中包含以下内容（至少还有其他指令）：

[listing]
----
# Allow server status reports generated by mod_status,
# with the URL of http://servername/server-status
<Location /server-status>
    SetHandler server-status
</Location>

#
# ExtendedStatus controls whether Apache will generate "full" status
# information (ExtendedStatus On) or just basic information (ExtendedStatus
# Off) when the "server-status" handler is called. The default is Off.
#
ExtendedStatus On
----
有关 "od_status" 模块的详细说明，请参见 link:https://httpd.apache.org/docs/2.4/mod/mod_status.html#enable["Apache 文档"]



== 对象和计数器

将收集以下对象及其计数器：

[cols="<.<,<.<,<.<,<.<"]
|===
| 对象： | 标识符： | 属性： | 数据点： 


| Apache | 命名空间
服务器 | 节点IP
节点名称
Port
父服务器配置生成
父服务器MPM生成
服务器运行时间
正在停止 | 繁忙的员工
每个请求的字节数
每秒字节数
CPU子系统
CPU子级用户
CPU负载
CPU系统
CPU用户
异步连接正在关闭
异步连接保持活动状态
异步连接写入
总连接数
每个请求的持续时间
闲置员工
负载平均值(最后1米)
平均负载(过去15米)
负载平均值(最后5米)
流程
每秒请求数
总访问量
总持续时间
总KB
记分板关闭
记分板DNS查找
记分板饰面
记分板闲置清理
记分板保持活动状态
记分板记录
记分板打开
记分板读数
记分板发送
记分板正在启动
记分板等待 
|===


== 故障排除

可以从找到追加信息 link:concept_requesting_support.html["支持"] 页面。
