---
sidebar: sidebar 
permalink: task_config_telegraf_docker.html 
keywords: telegraf, installation, install, docker 
summary: Docker 数据收集器配置 
---
= Docker Data Collector
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Cloud Insights 使用此数据收集器从 Docker 收集指标。



== 安装

. 从*Observability > Collectors*中，单击*+Data Collector*。选择Docker。
+
如果尚未配置代理进行收集，系统将提示您 link:task_config_telegraf_agent.html["安装代理"] 在您的环境中。

+
如果已配置代理，请选择相应的操作系统或平台，然后单击 * 继续 * 。

. 按照 Docker 配置屏幕中的说明配置数据收集器。这些说明因用于收集数据的操作系统或平台的类型而异。


image:DockerDCConfigLinux.png["Docker 配置"]



== 设置

适用于 Docker 的 Telegraf 输入插件通过指定的 UNIX 套接字或 TCP 端点收集指标。



=== 兼容性

配置是根据 Docker 1.12.6 版开发的。



=== 设置



=== 通过 UNIX 套接字访问 Docker

如果 Telegraf 代理正在 BareMetal 上运行，请运行以下命令将此 Telegraf Unix 用户添加到 Docker Unix 组：

 sudo usermod -aG docker telegraf
如果 Telegraf 代理在 Kubernetes Pod 中运行，请将此套接字映射到 Pod 中作为卷，然后将此卷挂载到 /var/run/docker.sock ，以公开 Docker Unix 套接字。  例如，将以下内容添加到 PodSpec 中：

[listing]
----
volumes:
...
- name: docker-sock
hostPath:
path: /var/run/docker.sock
type: File
----
然后，将以下内容添加到容器中：

[listing]
----
volumeMounts:
...
- name: docker-sock
mountPath: /var/run/docker.sock
----
请注意，为 Kubernetes 平台提供的 Cloud Insights 安装程序会自动执行此映射。



=== 通过 TCP 端点访问 Docker

默认情况下， Docker 使用端口 2375 进行未加密访问，而使用端口 2376 进行加密访问。



== 对象和计数器

将收集以下对象及其计数器：

[cols="<.<,<.<,<.<,<.<"]
|===
| 对象： | 标识符： | 属性： | 数据点： 


| Docker 引擎 | 命名空间
Docker 引擎 | 节点名称
节点IP
节点 UUID
节点操作系统
Kubbernetes集群
Docker版本
Unit | 内存
容器
容器已暂停
正在运行的容器
容器已停止
CPU
执行例行程序
映像
侦听器事件
已用文件描述符
数据可用
数据总量
已用数据
元数据可用
元数据总计
已用元数据
池封锁大小 


| Docker 容器 | 命名空间
容器名称
Docker 引擎 | Kubbernetes容器哈希
Kubnetes容器端口
Kubnetes容器重新启动计数
Kubernetes容器终止消息路径
Kubernetes容器终止消息策略
Kubernetes Pod终止宽限期
容器映像
容器状态
容器版本
节点名称
Kubbernetes容器日志路径
Kubbernetes容器名称
Kubnetes Docker类型
Kubbernetes Pod名称
Kubbernetes Pod命名空间
Kubbernetes Pod UID
Kubernetes沙盒ID
节点IP
节点 UUID
Docker版本
发现Kubnetes IO配置
Kubnetes IO配置源
OpenShift IO SCC
Kubnetes问题描述
Kubnetes显示名称
OpenShift标记
Kompose服务
POD模板哈希
控制器修订哈希
POD模板生成
许可证
架构构建日期
模式许可证
模式名称
模式URL
模式VCS URL
模式供应商
模式版本
模式架构版本
维护人员
客户Pod
Kubnetes状态设置Pod名称
租户
WEEBCONCONVOLE
架构
权威源URL
构建日期
RH构建主机
右侧部件
分销范围
安装
版本。
运行
摘要
卸载
VCS参考
VCS类型
供应商
version
运行状况
容器ID | 匿名内存活动
内存活动文件
内存缓存
内存分层限制
内存非活动匿名
内存非活动文件
内存限制
内存映射文件
内存最大使用量
内存页错误
内存页主要故障
内存已分页
内存分页超时
内存驻留集大小
内存驻留集大小巨大
活动的总内存匿名
总内存活动文件
内存总缓存
非活动内存总量匿名
内存总非活动文件
总内存映射文件
内存总页错误
内存总页主要故障
内存总寻呼量
内存总分页输出
内存驻留总集大小
内存驻留总集大小巨大
不可配置的总内存
内存不可配置
内存使用量
内存使用百分比
退出代码
Oom kiled.
PID
开始于
Streak失败 


| Docker 容器块 IO | 命名空间
容器名称
Device
Docker 引擎 | Kubbernetes容器哈希
Kubnetes容器端口
Kubnetes容器重新启动计数
Kubernetes容器终止消息路径
Kubernetes容器终止消息策略
Kubernetes Pod终止宽限期
容器映像
容器状态
容器版本
节点名称
Kubbernetes容器日志路径
Kubbernetes容器名称
Kubnetes Docker类型
Kubbernetes Pod名称
Kubbernetes Pod命名空间
Kubbernetes Pod UID
Kubernetes沙盒ID
节点IP
节点 UUID
Docker版本
发现Kubnetes配置
Kubnetes配置源
OpenShift SCC
Kubnetes问题描述
Kubnetes显示名称
OpenShift标记
模式架构版本
POD模板哈希
控制器修订哈希
POD模板生成
Kompose服务
架构构建日期
模式许可证
模式名称
模式供应商
客户Pod
Kubnetes状态设置Pod名称
租户
WEEBCONCONVOLE
构建日期
许可证
供应商
架构
权威源URL
RH构建主机
右侧部件
分销范围
安装
维护人员
版本。
运行
摘要
卸载
VCS参考
VCS类型
version
模式URL
模式VCS URL
模式版本
容器ID | IO服务字节递归异步
IO服务字节递归读取
IO服务字节递归同步
IO服务递归总字节数
IO服务字节递归写入
IO服务递归异步
IO服务递归读取
IO服务递归同步
IO服务递归总数
IO服务递归写入 


| Docker 容器网络 | 命名空间
容器名称
网络
Docker 引擎 | 容器映像
容器状态
容器版本
节点名称
节点IP
节点 UUID
节点操作系统
K8s集群
Docker版本
容器ID | Rx丢弃
Rx字节
Rx错误
Rx数据包
已删除TX
Tx字节
Tx错误
TX数据包 


| Docker 容器 CPU | 命名空间
容器名称
CPU
Docker 引擎 | Kubbernetes容器哈希
Kubnetes容器端口
Kubnetes容器重新启动计数
Kubernetes容器终止消息路径
Kubernetes容器终止消息策略
Kubernetes Pod终止宽限期
发现Kubnetes配置
Kubnetes配置源
OpenShift SCC
容器映像
容器状态
容器版本
节点名称
Kubbernetes容器日志路径
Kubbernetes容器名称
Kubnetes Docker类型
Kubbernetes Pod名称
Kubbernetes Pod命名空间
Kubbernetes Pod UID
Kubernetes沙盒ID
节点IP
节点 UUID
节点操作系统
Kubbernetes集群
Docker版本
Kubnetes问题描述
Kubnetes显示名称
OpenShift标记
模式版本
POD模板哈希
控制器修订哈希
POD模板生成
Kompose服务
架构构建日期
模式许可证
模式名称
模式供应商
客户Pod
Kubnetes状态设置Pod名称
租户
WEEBCONCONVOLE
构建日期
许可证
供应商
架构
权威源URL
RH构建主机
右侧部件
分销范围
安装
维护人员
版本。
运行
摘要
卸载
VCS参考
VCS类型
version
模式URL
模式VCS URL
模式版本
容器ID | 限制期限
限制限制的期间
限制受限时间
内核模式下的使用情况
用户模式下的使用
使用率百分比
使用系统
总使用量 
|===


== 故障排除

[cols="2*"]
|===
| 问题： | 请尝试以下操作： 


| 按照配置页面上的说明进行操作后，我在 Cloud Insights 中看不到 Docker 指标。 | 检查Telegraf代理日志、查看其是否报告以下错误：

 E！插件[Inputs.dock6]错误：尝试连接到Docker守护进程套接字时、权限被拒绝

如果是、请按照上述说明、采取必要步骤为Telegraf代理提供对Docker Unix套接字的访问权限。 
|===
可以从找到追加信息 link:concept_requesting_support.html["支持"] 页面。
