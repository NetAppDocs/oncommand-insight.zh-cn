---
sidebar: sidebar 
permalink: task_config_telegraf_kafka.html 
keywords: telegraf, installation, install, kafka 
summary: Kafka 数据收集器配置 
---
= Kafka 数据收集器
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Cloud Insights 使用此数据收集器从 Kafka 收集指标。



== 安装

. 从*Observability > Collectors*中，单击*+Data Collector*。选择Kafka。
+
选择安装了 Telegraf 代理的操作系统或平台。

. 如果您尚未安装要收集的代理，或者您希望为其他操作系统或平台安装代理，请单击 _Show Instructions_展开 link:task_config_telegraf_agent.html["代理安装"] 说明。
. 选择要用于此数据收集器的代理访问密钥。您可以通过单击 * + 代理访问密钥 * 按钮来添加新的代理访问密钥。最佳实践：仅当您要按操作系统 / 平台对数据收集器进行分组时，才使用其他代理访问密钥。
. 按照配置步骤配置数据收集器。这些说明因用于收集数据的操作系统或平台的类型而异。


image:KafkaDCConfigWindows.png["Kafka 配置"]



== 设置

Kafka 插件基于此电报的 JOLokia 插件。例如，需要从所有 Kafka 代理收集信息，因此需要在所有组件上通过 Jallokia 配置和公开 JMX 。



=== 兼容性

此配置是根据 Kafka 0.11.0.2 版开发的。



=== 设置

以下所有说明均假定您的 Kafka 安装位置为 "/opt/Kafka" 。您可以根据安装位置调整以下说明。



==== JOLokia Agent Jar

一个版本的 JOLokia 代理 JAR 文件必须是 link:https://jolokia.org/download.html["已下载"]。测试的版本为 JOLokia 代理 1.6.0 。

以下说明假定下载的 JAR 文件（ jolokia-jvm-1.6.0-agent.jar ）位于 "/opt/Kafka/libs/" 位置下。



==== Kafka 代理

要配置 Kafka 代理以公开此 JOLokia API ，您可以在调用 "Kafka-run-class.sh" 之前的 <Kafka_home>/bin/Kafka-server-start.sh 中添加以下内容：

[listing]
----
export JMX_PORT=9999
export RMI_HOSTNAME=`hostname -I`
export KAFKA_JMX_OPTS="-javaagent:/opt/kafka/libs/jolokia-jvm-1.6.0-agent.jar=port=8778,host=0.0.0.0  -Dcom.sun.management.jmxremote.password.file=/opt/kafka/config/jmxremote.password -Dcom.sun.management.jmxremote.ssl=false -Djava.rmi.server.hostname=$RMI_HOSTNAME -Dcom.sun.management.jmxremote.rmi.port=$JMX_PORT"
----
请注意，上述示例使用 "hostname -i" 设置 "RMI_HOSTNAME" 环境变量。在多个 IP 计算机中，需要对其进行调整，以收集您关心的用于 RMI 连接的 IP 。

您可以为 JMX （上面为 9999 ）和朱洛基亚（ 8778 ）选择其他端口。如果您有一个内部 IP 来锁定 Jallokia ，则可以将 "catch all" 0.0.0.0 替换为您自己的 IP 。请注意，此 IP 需要可从电报插件访问。如果您不想进行身份验证，可以使用选项 -Dcom.sun.management.jmxremote.authenticate=false' 。使用风险自行承担。



== 对象和计数器

将收集以下对象及其计数器：

[cols="<.<,<.<,<.<,<.<"]
|===
| 对象： | 标识符： | 属性： | 数据点： 


| Kafka Broker | 集群
命名空间
代理 | 节点名称
节点IP | 副本管理器Fetcher最大滞后时间
Zookeer客户端连接
Zookekeeer客户端连接(15m速率)
Zookekeeper客户端连接(5万次)
Zookekeeer客户端连接(平均速率)
Zookekeeer客户端连接(1米速率)
副本管理器分区计数
线程计数守护进程
线程数峰值
线程计数当前
已启动总线程数
脱机分区
生成请求总时间(第50个百分比)
生成请求总时间(第75个百分比)
生成请求总时间(第95个百分比)
生成请求总时间(98百分比)
生成请求总时间(999百分比)
生成请求总时间(第99个百分比)
生成请求总时间
生成请求总时间最大值
生成请求总时间平均值
生成请求总时间最小值
生成请求总时间Stddev
副本管理器ISR缩减
副本管理器ISR缩减(1500万速率)
副本管理器ISR缩减(5万次)
副本管理器ISR缩减(平均速率)
副本管理器ISR缩减(100万速率)
请求处理程序平均空闲时间
请求处理程序平均空闲时间(15m速率)
请求处理程序平均空闲时间(5米速率)
请求处理程序平均空闲时间(平均速率)
请求处理程序平均空闲时间(1米速率)
垃圾收集G1旧代计数
垃圾收集G1旧代时间
垃圾收集G1年轻一代计数
垃圾收集G1青年时代
Zookeer只读连接
Zookeer只读连接(15米速率)
Zookeer只读连接(5米速率)
Zookeer只读连接数(平均速率)
Zookeer只读连接(1米速率)
网络处理器平均空闲时间
请求提取响应总时间(第50个百分比)
请求提取响应总时间(第75个百分比)
请求提取响应总时间(第95个百分比)
请求提取响应总时间(第98个百分比)
请求提取响应总时间(第999个百分比)
请求提取响应总时间(第99个百分比)
请求提取操作者总时间
请求提取操作总时间最大值
请求提取响应者总平均时间
请求提取操作总时间最短
请求提取跟踪者总时间Stddev
在生产室中等待的请求
网络请求提取使用者
网络请求提取使用者(5万速率)
网络请求提取使用者(15m速率)
网络请求提取使用者(平均速率)
网络请求提取使用者(100万速率)
不洁的领袖选举
不干净的领导人选举(1500万人)
不干净的领导人选举(5万人)
不干净的领袖选举(平均比率)
不干净的领导人选举(100万人)
活动控制器
已提交堆内存
堆内存已启用
堆内存最大值
已用堆内存
Zookekeeper会话过期
Zookekeeper会话过期(1500万次)
Zookekeeper会话过期(5万次)
Zookekeeper会话到期(平均速率)
Zookeekeeper会话到期(1米速率)
Zookeer身份验证失败
Zookeer身份验证失败(15m速率)
Zookekeeer身份验证失败次数(5万次)
Zookeer身份验证失败次数(平均速率)
Zookeer身份验证失败次数(100万次)
领导者选举时间(第50个分位)
领导者选举时间(75分位值)
领导者选举时间(第95个百分点)
领导者选举时间(第98个百分位)
领导者选举时间(第999个百分点)
领导者选举时间(第99个百分位)
领导者选举计数
领导者选举时间(1500米)
领导者选举时间(5万次)
领导者选举时间最长
领导者选举时间平均值
领导者选举时间(平均率)
领导者选举时间最短
领导者选举时间(100万次)
领导者选举时间(stddev)
网络请求提取操作者
网络请求提取响应器(15m速率)
网络请求提取响应者(5米速率)
网络请求提取响应者(平均速率)
网络请求提取响应者(1米速率)
代理主题消息
代理主题消息(1500万速率)
代理主题消息(5万次)
代理主题消息(平均速率)
代理主题消息(100万速率)
代理主题字节输入
代理主题字节数(15m速率)
代理主题字节数(5米速率)
代理主题字节数(平均速率)
代理主题字节输入(1米速率)
Zookeer断开连接计数
Zookeer断开连接(15m速率)
Zookeer断开连接(5米速率)
Zookeer断开连接(平均速率)
Zookeer断开连接(1米速率)
网络请求提取使用者总时间(第50个百分比)
网络请求提取使用者总时间(第75个百分比)
网络请求提取使用者总时间(第95个百分比)
网络请求提取使用者总时间(第98个百分比)
网络请求提取使用者总时间(第999个百分比)
网络请求提取使用者总时间(第99个百分比)
网络请求提取使用者总时间
网络请求提取使用者总时间最大值
网络请求提取使用者总时间平均值
网络请求提取使用者最短总时间
网络请求提取使用者总时间Stddev
LeaderCount
请求正在Fetch Purgatory中等待
代理主题字节输出
代理主题字节输出(15m速率)
代理主题字节输出(5米速率)
代理主题字节输出(平均速率)
代理主题字节输出(1米速率)
ZookeeKeeer的各种方法
Zookeeekeeer的各种数据(15m速率)
ZookeKeeer的各种数据(5万次)
ZookeKeeer的证言(平均速率)
Zookeeekeeer的各种数据(1米)
请求生成计数
请求生成(1500万次速率)
请求生成(5万次)
请求生成(平均速率)
请求生成(100万速率)
副本管理器ISR扩展
副本管理器ISR扩展(1500万速率)
副本管理器ISR扩展(5万速率)
副本管理器ISR扩展(平均速率)
副本管理器ISR扩展(100万速率)
"复制的分区"下的"副本管理器 
|===


== 故障排除

可以从找到追加信息 link:concept_requesting_support.html["支持"] 页面。
